require Remote

dim hosts as string[]={"127.0.0.1","127.0.0.1"}
dim ports as int[]={13080,13090}
//dim hosts as string[]=new string[0]
//dim ports as int[]=new int[0]
dim mem_hosts as string[]={"127.0.0.1"}
dim mem_ports as int[]={11211}
dim nodes as RemoteNode[]=ConnectNode(5080,hosts,ports,mem_hosts,mem_ports)
dim toput as double[]
dim buf as shared double[] global=new double[50000] global
dim accu as shared RAccumulator=new RAccumulator(2,50000,buf)

function proc(par as var) as int
    dim localbuf as double[]=new double[50000]
    dim i as int
    for i=0;i<50000;i++
        localbuf[i]=par
    end
    for #i=0;#i<5;#i++
        accu.Accumulate(localbuf,-1)
        println(buf[0])
    end
end

nodes[0].CreateThread(proc,1)
nodes[1].CreateThread(proc,2)

gets()
